---
title: linux_filesystem
date: 2020-08-19 10:02:20
tags: [Linux,filesystem,文件系统]
categories: [Linux,filesystem,文件系统]
---
Linux中常见的文件系统是ext4文件系统，那文件系统的基本组成是什么样的呢？Linux操作系统中，文件除了实际的数据之外还有诸如权限、文件属性类的数据。文件系统通常会将实际的数据存放在`block`中，而权限及文件属性数据存放在`inode`中。

## inode 和 block 概述
文件是存储在硬盘上的，硬盘的最小存储单位叫做扇区`sector`，每个扇区存储`512字节`。操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个块`block`。这种由多个扇区组成的块，是文件存取的最小单位。块的大小，最常见的是`4KB`，即连续八个sector组成一个`block`。

文件数据存储在块中，那么还必须找到一个地方存储文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种存储文件元信息的区域就叫做`inode`，中文译名为`索引节点`，也叫`i节点`。因此，一个文件必须占用一个`inode`，但至少占用一个`block`。

* 元信息：inode
* 数据: block

## inode内容
`inode`包含很多的文件元信息，但不包含文件名，例如：字节数、属主`UserID`、属组`GroupID`、读写执行权限、时间戳等。

而文件名存放在目录当中，但Linux系统内部不使用文件名，而是使用`inode号码`识别文件。对于系统来说文件名只是`inode号码`便于识别的别称。

## inode号码
可以通过`stat`命令或者`ls -i`命令查看文件或者目录的`inode号码`。
```bash
stat readme.txt
  文件："readme.txt"
  大小：6          块：8          IO 块：4096   普通文件
设备：fc02h/64514d Inode：88617255    硬链接：1
权限：(0664/-rw-rw-r--)  Uid：( 5002/xxx)   Gid：( 1003/xxx)
最近访问：2020-08-19 10:19:33.431665414 +0800
最近更改：2020-08-19 10:19:33.431665414 +0800
最近改动：2020-08-19 10:19:33.431665414 +0800
创建时间：-

ls -i readme.txt
88617255 readme.txt

```
表面上，用户通过文件名打开文件，实际上，系统内部将这个过程分为三步：
1. 系统找到这个文件名对应的`inode号码`；
2. 通过`inode号码`，获取`inode信息`；
3. 根据`inode信息`，找到文件数据所在的`block`，并读出数据。
其实系统还要根据`inode信息`，看用户是否具有`访问权限`，有就指向对应的数据`block`，没有就返回权限拒绝。